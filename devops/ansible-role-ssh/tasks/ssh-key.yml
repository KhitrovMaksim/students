- name: Touch a file, using symbolic modes to set the permissions (equivalent to 0644)
  ansible.builtin.file:
    path: /etc/id_rsa
    state: touch
    mode: u=rw,g=r,o=r

- name: Show file 1
  ansible.builtin.debug:
    msg: "{{ lookup('ansible.builtin.file', '{{ ansible_env.HOME }}/etc/id_rsa') }}"

- name: Copy authorized key from env to file.
  copy:
    dest: /etc/id_rsa
    content: "{{ ssh_key }}"

- name: Show file 2
  ansible.builtin.debug:
    msg: "{{ lookup('ansible.builtin.file', '{{ ansible_env.HOME }}/etc/id_rsa') }}"

- name: Set authorized key for remote user.
  authorized_key:
    user:  admin
    state: present
    key: "{{ lookup('file', '{{ ansible_env.HOME }}/etc/id_rsa.pub') }}"